---
title: "localstackã¨terraformã§ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®dynamodbä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ“¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["localstack", "terraform", "aws", "dynamodb"]
published: true
---

## ã¯ã˜ã‚ã«
ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’dynamodbã«ä¿å­˜ã™ã‚‹æ©Ÿèƒ½ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ã«ãªã£ãŸã®ã§ã™ãŒã€AWSã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã¨èª²é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚
ãªã®ã§localstackã¨ã„ã†ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§AWSç’°å¢ƒã‚’å†ç¾ã§ãã‚‹ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
å‚™å¿˜éŒ²ã¨ã—ã¦dynamodbã‚’æ§‹ç¯‰ã™ã‚‹ã¾ã§ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

## localstackã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã“ã¡ã‚‰
ã„ã‚ã„ã‚æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ãŒã€ç§ã¯`docker compose`ã®æ–¹æ³•ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚
https://docs.localstack.cloud/aws/getting-started/installation/#docker-compose

ä»Šå›ã¯ç„¡æ–™ã®ç¯„å›²ã§ãªã‚“ã¨ã‹ãªã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ä¾‹ãˆã°ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã§ã‚ã‚‹ã¨ã‹ãã®ä»–ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã—ãŸã„å ´åˆã¯æœ‰æ–™ãƒ—ãƒ©ãƒ³ã«åŠ å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚

## ç–é€šç¢ºèª

localstackã®dockerç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ãŸå¾Œã€curlã§ç–é€šç¢ºèªã—ã¾ã™ã€‚
ã“ã‚“ãªæ„Ÿã˜ã§jsonãŒå‡ºåŠ›ã•ã‚ŒãŸã‚‰okã§ã™ã€‚

```bash
â¯ curl localhost:4566/_localstack/health

# å‡ºåŠ›çµæœ
{"services": {"acm": "available", "apigateway": "available", "cloudformation": "available", "cloudwatch": "available", "config": "available", "dynamodb": "running", "dynamodbstreams": "available", "ec2": "available", "es": "available", "events": "available", "firehose": "available", "iam": "available", "kinesis": "available", "kms": "available", "lambda": "available", "logs": "available", "opensearch": "available", "redshift": "available", "resource-groups": "available", "resourcegroupstaggingapi": "available", "route53": "available", "route53resolver": "available", "s3": "running", "s3control": "available", "scheduler": "available", "secretsmanager": "available", "ses": "available", "sns": "available", "sqs": "available", "ssm": "available", "stepfunctions": "available", "sts": "available", "support": "available", "swf": "available", "transcribe": "available"}, "edition": "community", "version": "4.9.3.dev51"}
```

## dynamodbã‚’æ§‹ç¯‰ã™ã‚‹

terraformã‚’ä½¿ã£ã¦dynamodbã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
localstackã®dockerç’°å¢ƒã¨ã¯åˆ¥ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§terraformã‚’ä½œæˆã—ã¾ã—ãŸã€‚
terraformã®ã‚³ãƒ¼ãƒ‰ã®å¤§æ ã¯geminiã«å‡ºåŠ›ã—ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws",
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "ap-northeast-1"

  access_key = "test"
  secret_key = "test"

  skip_credentials_validation = true
  skip_metadata_api_check     = true
  skip_requesting_account_id  = true

  endpoints {
    dynamodb = "http://localhost:4566"
    s3       = "http://localhost:4566"
  }
}

resource "aws_dynamodb_table" "dynamodb-test-table" {
  name           = "dynamodb-test-table"
  billing_mode   = "PAY_PER_REQUEST"
  hash_key       = "TenantId"
  range_key      = "CreatedAt"

  attribute {
    name = "TenantId"
    type = "S"
  }

  attribute {
    name = "CreatedAt"
    type = "S"
  }

  ttl {
    attribute_name = "ExpiredAt"
    enabled = true
  }

  tags = {
    Environment = "local-dev"
    ManagedBy   = "Terraform"
  }
}

```

tfãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã§ããŸã‚‰ã€terraformã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦localstackã«åæ˜ ã—ã¾ã™ã€‚

```bash
# terraformã®åˆæœŸåŒ–
â¯ terraform init

# terraformã®å®Ÿè¡Œè¨ˆç”»ç¢ºèª
â¯ terraform plan

# localstackã«åæ˜ 
â¯ terraform apply
```

## dynamodbãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

```bash
# ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«credentialsã‚’è¨­å®š
â¯ cat ~/.aws/credentials
[localstack]
aws_access_key_id = test
aws_secret_access_key = test
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰awsã‚³ãƒãƒ³ãƒ‰ã§dynamodbã®æƒ…å ±ã‚’å‡ºåŠ›

```bash
â¯ aws dynamodb describe-table --table-name dynamodb-test-table \
 --endpoint-url=http://localhost:4566 \
 --profile=localstack \
 --region=ap-northeast-1

 # å‡ºåŠ›çµæœ
{
    "Table": {
        "AttributeDefinitions": [
            {
                "AttributeName": "CreatedAt",
                "AttributeType": "S"
            },
            {
                "AttributeName": "TenantId",
                "AttributeType": "S"
            }
        ],
        "TableName": "dynamodb-test-table",
        "KeySchema": [
            {
                "AttributeName": "TenantId",
                "KeyType": "HASH"
            },
            {
                "AttributeName": "CreatedAt",
                "KeyType": "RANGE"
            }
        ],
        "TableStatus": "ACTIVE",
        "CreationDateTime": "2025-10-30T14:24:39.366000+09:00",
        "ProvisionedThroughput": {
            "LastIncreaseDateTime": "1970-01-01T09:00:00+09:00",
            "LastDecreaseDateTime": "1970-01-01T09:00:00+09:00",
            "NumberOfDecreasesToday": 0,
            "ReadCapacityUnits": 0,
            "WriteCapacityUnits": 0
        },
        "TableSizeBytes": 0,
        "ItemCount": 0,
        "TableArn": "arn:aws:dynamodb:ap-northeast-1:000000000000:table/dynamodb-test-table",
        "TableId": "cfaafca0-d042-47fb-ba72-a6bc79b74353",
        "BillingModeSummary": {
            "BillingMode": "PAY_PER_REQUEST",
            "LastUpdateToPayPerRequestDateTime": "2025-10-30T14:24:39.366000+09:00"
        },
        "DeletionProtectionEnabled": false,
        "WarmThroughput": {
            "ReadUnitsPerSecond": 12000,
            "WriteUnitsPerSecond": 4000,
            "Status": "ACTIVE"
        }
    }
}
```

## ã•ã„ã”ã«
ã¨ã¦ã‚‚ã‚µã‚¯ãƒƒã¨ç’°å¢ƒãŒæ§‹ç¯‰ã§ããŸã®ã§åŠ©ã‹ã‚Šã¾ã—ãŸã€‚
ã“ã‚Œã§ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®æ©Ÿèƒ½å®Ÿè£…ã‚‚æ—ã‚Šã¾ã™ã€‚