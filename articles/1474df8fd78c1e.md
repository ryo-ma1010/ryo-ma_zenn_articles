---
title: "GA4ã§åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’APIã§å–å¾—ã™ã‚‹"
emoji: "ğŸ’¬"
type: "tech"
topics:
  - "googleanalytics"
  - "php"
  - "ga4"
published: true
published_at: "2022-08-08 15:41"
---

:::message alert
ã“ã®è¨˜äº‹ã¯è‡ªåˆ†ãŒç¤¾å†…ã§ã¾ã¨ã‚ã¦ã„ãŸã‚‚ã®ã‚’è»¢è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚
æƒ…å ±ãŒå¤ã„æã‚ŒãŒã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚
æŠ•ç¨¿æ—¥ï¼š2021/12/07
:::

## å‰ç½®ã

gtagã§åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’APIã§å–å¾—ã™ã‚‹ã«ã¯ã€GoogleAnalyticsReporting v4ã‚’åˆ©ç”¨ã™ã‚‹ãŒã€
GA4ã®å ´åˆã€GoogleAnalyticsDataApiã‚’åˆ©ç”¨ã™ã‚‹ã€‚

å…ˆæ–¹ãŒGA4ã‚’ä½¿ç”¨ã—ã¦ã„ãŸã“ã¨ã‹ã‚‰ã€åˆ©ç”¨ã§ãã‚‹APIã«ã¤ã„ã¦ã„ã‚ã„ã‚èª¿æŸ»ã—ãŸã€‚
ç¾åœ¨(2021/12/07æ™‚ç‚¹)ã€GA4ç”¨ã®APIã¯ãƒ™ãƒ¼ã‚¿ç‰ˆã®ã¿ã§ã€æ—¥æœ¬èªã§ã®çŸ¥è¦‹ã¯ã»ã¨ã‚“ã©ãªãã€è‹±èªã§ã‚‚ã‚ã¾ã‚Šè¦‹ã‚‰ã‚Œãªã„ã®ã§APIã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã€GA4ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãã§ã¯ãªã„ã€‚

## Google Analytics Data API

[Analytics Data API Overview](https://developers.google.com/analytics/devguides/reporting/data/v1) 

> Beta
> This is a Beta version of the product. While no breaking changes are expected in this phase, pre-GA products may have limited support, and changes to pre-GA products may not be compatible with other pre-GA versions.

orverviewã«ã‚ˆã‚‹ã¨ã€ç¾åœ¨ãƒ™ãƒ¼ã‚¿ç‰ˆã—ã‹åˆ©ç”¨ã§ããªã„ã‚‰ã—ã„ã€‚

## åˆ©ç”¨æ–¹æ³•

[API Quickstart](https://developers.google.com/analytics/devguides/reporting/data/v1/quickstart-client-libraries) 
 [Google Analytics Data for PHP/README.md](https://github.com/googleapis/php-analytics-data#google-analytics-data-for-php) 

ã–ã£ãã‚Šã„ã†ã¨
1. GoogleCloudPlatformã§Google Analytics Data APIã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚
2. GoogleCloudPlatformã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã€ç§˜å¯†éµã‚’å–å¾—ã™ã‚‹ã€‚
3. GoogleAnalyticsã®ç®¡ç†ç”»é¢ã‹ã‚‰ã€å·¦ä¸‹ã®ç®¡ç†>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼(GoogleCloudPlatformã§ä½œæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)ã‚’è¿½åŠ ã€‚
4. composerã§å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’requireã™ã‚‹ã€‚ã‚µãƒ¼ãƒãƒ¼ã«phpã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€php-bcmathã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

phpã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯API Quickstartã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã™ã‚‹ã€‚

## APIã‚’åˆ©ç”¨ã—ã¦ã¿ã‚‹

ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¸€éƒ¨æ›¸ãæ›ãˆã¦è©¦ã—ã¦ã¿ã‚‹ã€‚

### analyticsDataApi.php

```php
<?php
require 'vendor/autoload.php';

use Google\Analytics\Data\V1beta\BetaAnalyticsDataClient;
use Google\Analytics\Data\V1beta\DateRange;
use Google\Analytics\Data\V1beta\Dimension;
use Google\Analytics\Data\V1beta\Metric;

/**
 * TODO(developer): Replace this variable with your Google Analytics 4
 *   property ID before running the sample.
 */
$property_id = '{ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ID}';

// Using a default constructor instructs the client to use the credentials
// specified in GOOGLE_APPLICATION_CREDENTIALS environment variable.
$client = new BetaAnalyticsDataClient([
    'credentials' => '{ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç§˜å¯†éµ}',
]);

// Make an API call.
$response = $client->runReport([
    'property' => 'properties/' . $property_id,
    'dateRanges' => [
        new DateRange([
            'start_date' => '2020-03-31',
            'end_date' => 'today',
        ]),
    ],
    'dimensions' => [
        new Dimension([
            'name' => 'pagePathPlusQueryString',
        ]),
    ],
    'metrics' => [
        new Metric([
            'name' => 'screenPageViews',
        ]),
        new Metric([
            'name' => 'totalUsers',
        ]),
    ]
]);

// Print results of an API call.
print 'Report result: ' . PHP_EOL;
foreach ($response->getRows() as $key => $row) {
    $data[$key]['pagePath'] = $row->getDimensionValues()[0]->getValue();
    $data[$key]['pageViews'] = $row->getMetricValues()[0]->getValue();
    $data[$key]['user'] = $row->getMetricValues()[1]->getValue();
}

print_r($data);
```

### å‡ºåŠ›

```
# php analyticsDataApi.php
Report result: 
Array
(
    [0] => Array
        (
            [pagePath] => /
            [pageViews] => 19
            [user] => 4
        )

    [1] => Array
        (
            [pagePath] => /products/detail.php?product_id=11763
            [pageViews] => 8
            [user] => 7
        )
)
```

# å‚è€ƒ

## ä½¿ç”¨ã§ãã‚‹é …ç›®ä¸€è¦§

https://developers.google.com/analytics/devguides/reporting/data/v1/api-schema

## ä½¿ç”¨ã§ãã‚‹Dimensionsã‚„Metricsã‚’APIã§å–å¾—ã™ã‚‹

https://developers.google.com/analytics/devguides/reporting/data/v1/rest/v1alpha/TopLevel/getMetadata

## Reporting APIã‹ã‚‰ã®ç§»è¡Œ

https://developers.google.com/analytics/devguides/migration/api/reporting-ua-to-ga4

## Reporting APIã¨Data APIã®å–å¾—ã§ãã‚‹é …ç›®ã®å¯¾å¿œè¡¨

https://developers.google.com/analytics/devguides/migration/api/reporting-ua-to-ga4-dims-mets